generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          String       @id @default(cuid())
  username    String       @unique
  password    String
  name        String
  role        UserRole     @default(PETUGAS)
  kodeKoord   String?
  kodePetugas String?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  koordinator Koordinator?
  petugas     Petugas?
}

model Piutang {
  id            String        @id @default(cuid())
  idPelanggan   String
  namaPelanggan String
  kodeWilayah   String
  rupiahPiutang Float
  status        StatusPiutang @default(BELUM_LUNAS)
  bulan         String
  tahun         String
  petugasId     String
  koordinatorId String
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  koordinator   Koordinator   @relation(fields: [koordinatorId], references: [id])
  petugas       Petugas       @relation(fields: [petugasId], references: [id])
  setoran       Setoran[]     @relation("PiutangToSetoran")
}

model Koordinator {
  id        String    @id @default(cuid())
  kodeKoord String    @unique
  namaKoord String
  userId    String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  user      User      @relation(fields: [userId], references: [id])
  petugas   Petugas[]
  piutang   Piutang[]
  rekap     Rekap[]
  setoran   Setoran[]
}

model Petugas {
  id            String      @id @default(cuid())
  kodePetugas   String      @unique
  namaPetugas   String
  userId        String      @unique
  koordinatorId String
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  koordinator   Koordinator @relation(fields: [koordinatorId], references: [id])
  user          User        @relation(fields: [userId], references: [id])
  piutang       Piutang[]
  rekap         Rekap[]
  setoran       Setoran[]
}

model Rekap {
  id            String       @id @default(cuid())
  bulan         String
  tahun         String
  koordinatorId String?
  petugasId     String?
  sisaPiutang   Float        @default(0)
  lunasPiutang  Float        @default(0)
  totalPiutang  Float        @default(0)
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  koordinator   Koordinator? @relation(fields: [koordinatorId], references: [id])
  petugas       Petugas?     @relation(fields: [petugasId], references: [id])
}

model Setoran {
  id            String        @id @default(cuid())
  rupiahSetor   Float
  bulanSetor    String
  tanggalSetor  DateTime
  koordinatorId String
  petugasId     String
  status        StatusSetoran @default(PENDING)
  keterangan    String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  koordinator   Koordinator   @relation(fields: [koordinatorId], references: [id])
  petugas       Petugas       @relation(fields: [petugasId], references: [id])
  piutang       Piutang[]     @relation("PiutangToSetoran")
}

enum UserRole {
  ADMIN
  KOORDINATOR
  PETUGAS
}

enum StatusPiutang {
  LUNAS
  BAYAR_SEBAGIAN
  JANJI_BAYAR
  BELUM_LUNAS
}

enum StatusSetoran {
  ACCEPT
  DECLINE
  PENDING
}
